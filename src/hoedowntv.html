
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style media="screen">
      :root {
        --header-height: 64px;
        --main-color: #4c72b9;
        --theme-color: #395486;
        --background-color: rgb(179, 179, 179);
      }
      @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 400;
        font-display: fallback;
        src: url('../fonts/roboto-v15-latin-regular.eot'); /* IE9 Compat Modes */
        src: local('Roboto'), local('Roboto-Regular'),
           url('../fonts/roboto-v15-latin-regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
           url('../fonts/roboto-v15-latin-regular.woff2') format('woff2'), /* Super Modern Browsers */
           url('../fonts/roboto-v15-latin-regular.woff') format('woff'), /* Modern Browsers */
           url('../fonts/roboto-v15-latin-regular.ttf') format('truetype'), /* Safari, Android, iOS */
           url('../fonts/roboto-v15-latin-regular.svg#Roboto') format('svg'); /* Legacy iOS */
      }
      body {
        display: flex;
        justify-content: center;
        background: var(--background-color);
        font-family: 'Roboto', 'Noto', sans-serif;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: var(--header-height);
        background: var(--main-color);
        color: #ffffff;
        font-size: 24px;
        font-weight: bolder;
      }
      .header-shadow {
        height: 6px;
        box-shadow: inset 0px 5px 6px -3px rgba(0,0,0,0.4);
        position: absolute;
        will-change: auto;
        top: var(--header-height);
        left: 0;
        right: 0;
        pointer-events: none;
        z-index: 1;
      }
      #video {
        width: 100%;
        pointer-events: none;
      }
      .card {
        width: 60%;
        background: #fff;
        z-index: 1;
        position: relative;
        margin: auto;
        border-radius: 20px;
        margin-bottom: 8px;
        box-shadow: 0 2px 2px 0 rgba(0,0,0,0.14),0 1px 5px 0 rgba(0,0,0,0.12),0 3px 1px -2px rgba(0,0,0,0.2);
        text-align: center;
        overflow: hidden;
        padding-bottom: 24px;
      }
      .container {
        position: fixed;
        will-change: auto;
        top: var(--header-height);
        margin: auto;
        bottom: 0;
        left:0;
        right:0;
        overflow: auto;
        overflow-x: hidden;
        padding:8px;
        transform: translateZ(0);
        -webkit-overflow-scrolling: touch;
        text-align: center;
        background: var(--background-color);
      }
      .playeronline {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        border-bottom: 1px solid #d2d2d2;
        margin: 0 16px;
      }
      .media-keys {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: -4px 0;
        background: #f1f1f1;
      }
      .rb {
        position: relative;
        padding: 8px;
      }
      svg {
        cursor: pointer;
      }
      @media only screen and (max-width: 800px) {
        .card {
          width: 90%;
          border-radius: 10px;
        }
        .playeronline {
          margin: 0 8px;
        }
      }
    </style>
    <title>Hoedown TV</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  </head>
  <body>
    <header>HoedownTV</header>
    <div class="header-shadow"></div>
    <div class="container">
      <div class="card">
        <video id="video" poster="images/yeeeeeehawwwwwwmf.webp"></video>
        <div class='media-keys'>
          <div class="rb" id="play">
            <svg style="width:24px;height:24px" viewBox="0 0 24 24">
              <path id="playIcon" fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" />
            </svg>
          </div>
          <div class="rb" id="mute">
            <svg style="width:24px;height:24px" viewBox="0 0 24 24">
              <path id="muteIcon" fill="currentColor" d="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z" />
            </svg>
          </div>
          <div class="rb" id="fullscreen">
            <svg style="width:24px;height:24px" viewBox="0 0 24 24">
              <path fill="currentColor" d="M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z" />
            </svg>
          </div>
        </div>
        <div id="players"></div>
      </div>
    </div>
    <script>
      function qs(selector, scope) {
        return (scope || document).querySelector(selector)
      }

      function qsa(selector, scope) {
        return (scope || document).querySelectorAll(selector)
      }

      function attachRoundButtonRipple(button) {
        button.PaperRipple = new PaperRipple();
        button.appendChild(button.PaperRipple.$);
        button.PaperRipple.$.classList.add('paper-ripple--round');
        button.PaperRipple.recenters = true;
        button.PaperRipple.center = true;
        button.addEventListener('mousedown', ev => button.PaperRipple.downAction(ev));
        button.addEventListener('mouseup', ev => button.PaperRipple.upAction());
      }

      /**
       * push csS file to DOM
       * @param {String} src - url
       */
      function loadCSSFile(src) {
        return new Promise((resolve, reject) => {
          const css = document.createElement( "link" );
          css.href = src;
          css.type = "text/css";
          css.rel = "stylesheet";
          css.onload = resolve;
          css.onerror = reject;
          qs('head').appendChild(css);
        });
      }

      /**
       * push JS file to DOM
       * @param {String} src - url
       */
      function loadJSFile(src) {
        return new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.async = true;
          script.defer = true;
          script.src = src;
          script.onload = setTimeout(resolve, 50);
          script.onerror = reject;
          qs('body').appendChild(script);
        });
      }

      /**
       * loads paper ripples effect to DOM
       */
      function loadRipples() {
        return new Promise((resolve, reject) => {
          loadCSSFile("../css/paper-ripple.min.css").then(_ => {
            loadJSFile('../js/paper-ripple.min.js').then(resolve).catch(reject);
          }).catch(reject);
        });
      }

      /**
       * display statistics about a player
       *
       * @param {Object} player - player object from GameDig node js module
       */
      function displayPlayer(player) {
        var playerName = player.name;
        const wrapper = document.createElement('div');
        wrapper.classList.add('playeronline');
        const playerDiv = document.createElement('div');
        playerDiv.textContent = playerName;
        const score = document.createElement('div');
        score.textContent = player.score;
        wrapper.appendChild(playerDiv);
        wrapper.appendChild(score);
        return wrapper;
      }

      /**
       * returns a element with "server offline" text
       */
      function offlineServer() {
        const div = document.createElement('div');
        div.textContent = "Server offline";
        return div;
      }

      /**
       * returns a element with "no players online" text
       */
      function emptyServer() {
        const div = document.createElement('div');
        div.style.padding = '16px';
        div.textContent = "No Players Online";
        return div;
      }

      /**
       * lparse and display server statistics
       *
       * @param {Object} status - status object from GameDig node js module
       */
      function parseServerStatus(status) {
        const pContainer = qs('#players');
        pContainer.innerHTML = '';
        pContainer.appendChild(displayPlayer({
          name: "Player Name",
          score: "Score"
        }));
        if (status !== "offline") {
          numPlayersOnline = status.players.length;
          if (numPlayersOnline === 0) {
            pContainer.appendChild(emptyServer());
          } else {
            for (let i = 0; i < numPlayersOnline; i++) {
              pContainer.appendChild(displayPlayer(status.players[i]));
            }
          }
        } else {
          pContainer.appendChild(offlineServer());
        }
      }

      function lagCompensate(cb) {
        setTimeout(cb, 50 * 1000);
      }

      function getPlayers(firstCall) {
        fetch('https://hl2dm.dough10.me/api/status').then(response => {
          if (response.status !== 200) {
            console.error(response.status);
            return;
          }
          response.json().then(data => {
            if (!firstCall) {
              return lagCompensate(_ => {
                parseServerStatus(data);
              });
            }
            parseServerStatus(data);
          });
        });
      }

      window.onload = loadRipples().then(_ => {
        getPlayers(true);
        setInterval(_ => {
          getPlayers(false);
        }, 10000);
        qsa('.rb').forEach(attachRoundButtonRipple);
        if(Hls.isSupported()) {
          var video = qs('video');
          var hls = new Hls();
          hls.loadSource('https://hl2dm.dough10.me/hls/hl2mp.m3u8');
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, video.play);
          qs('#play').addEventListener('click', _ => {
            if (video.paused) {
              qs('#playIcon').setAttribute('d', `M14,19H18V5H14M6,19H10V5H6V19Z`);
              return video.play();
            }
            qs('#playIcon').setAttribute('d', `M8,5.14V19.14L19,12.14L8,5.14Z`);
            video.pause();
          });
          qs('#mute').addEventListener('click', _ => {
            if (!video.muted) {
              qs('#muteIcon').setAttribute('d', 'M3,9H7L12,4V20L7,15H3V9M16.59,12L14,9.41L15.41,8L18,10.59L20.59,8L22,9.41L19.41,12L22,14.59L20.59,16L18,13.41L15.41,16L14,14.59L16.59,12Z');
              video.muted = true;
              return;
            }
            qs('#muteIcon').setAttribute('d', 'M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z');
            video.muted = false;
          });
          qs('#fullscreen').addEventListener('click', _ => {
            video.requestFullscreen();
          });
        }
      });
    </script>
  </body>
</html>
